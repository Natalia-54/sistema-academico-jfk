<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IE John F. Kennedy - Panel Profesor</title>
    <style>
        :root {
            --primary-color: #2E7D32;
            --primary-light: #4CAF50;
            --primary-dark: #1B5E20;
            --secondary-color: #8BC34A;
            --accent-color: #FFC107;
            --light-color: #FFFFFF;
            --dark-color: #212121;
            --border-color: #E0E0E0;
            --text-secondary: #757575;
            --success-color: #4CAF50;
            --warning-color: #FFC107;
            --danger-color: #F44336;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #F5F7FA;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            color: white;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            animation: slideDown 0.5s ease-out;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .school-info {
            display: flex;
            align-items: center;
        }
        
        .school-logo {
            height: 50px;
            margin-right: 15px;
            animation: fadeIn 1s ease-in;
        }
        
        .teacher-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .btn {
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-logout {
            background-color: rgba(255,255,255,0.2);
            color: white;
        }
        
        .btn-logout:hover {
            background-color: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        /* Contenedor principal */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Tarjeta de información del profesor */
        .teacher-card {
            background-color: var(--light-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.3s ease;
        }
        
        .teacher-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .teacher-info h2 {
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }
        
        .teacher-details {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        
        .teacher-detail {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .teacher-detail i {
            color: var(--primary-color);
        }
        
        .teacher-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-light);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .teacher-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        /* Menú de opciones */
        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .option-card {
            background-color: var(--light-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            text-align: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }
        
        .option-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.1);
            background-color: var(--primary-light);
            color: white;
            border-color: var(--primary-color);
        }
        
        .option-card:hover .option-icon {
            color: white;
            transform: scale(1.1);
        }
        
        .option-card:hover .option-title {
            color: white;
        }
        
        .option-card:hover .option-desc {
            color: rgba(255,255,255,0.9);
        }
        
        .option-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            transition: all 0.3s ease;
        }
        
        .option-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary-dark);
            transition: all 0.3s ease;
        }
        
        .option-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }
        
        /* Secciones dinámicas */
        .section {
            display: none;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            animation: fadeIn 0.5s ease;
        }
        
        .section.active {
            display: block;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--primary-dark);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
        }
        
        /* Tablas */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .data-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        .data-table tr:hover {
            background-color: rgba(0,0,0,0.02);
        }
        
        /* Formularios */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        /* Alertas */
        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .alert-success {
            background-color: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }
        
        .alert-error {
            background-color: rgba(244, 67, 54, 0.1);
            border: 1px solid var(--danger-color);
            color: var(--danger-color);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            border-top: 1px solid var(--border-color);
            margin-top: 2rem;
        }
        
        /* Efectos de carga */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .loading {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .fa-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Badges */
        .badge {
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .badge-success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
        }
        
        .badge-warning {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }
        
        .badge-danger {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger-color);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .teacher-card {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .teacher-details {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .options-container {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="school-info">
                <img src="logo-jfk.png" alt="Logo IE John F. Kennedy" class="school-logo">
                <h1>IE John F. Kennedy - Panel Profesor</h1>
            </div>
            <div class="teacher-controls">
                <span id="teacherName">Profesor</span>
                <button class="btn btn-logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                </button>
            </div>
        </div>
    </header>
    
    <!-- Contenido principal -->
    <div class="container">
        <!-- Tarjeta de información del profesor -->
        <div class="teacher-card">
            <div class="teacher-info">
                <h2 id="teacherFullName">Información del Profesor</h2>
                <div class="teacher-details">
                    <div class="teacher-detail">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <span id="teacherSpecialty">Cargando...</span>
                    </div>
                    <div class="teacher-detail">
                        <i class="fas fa-id-card"></i>
                        <span id="teacherCode">Cargando...</span>
                    </div>
                    <div class="teacher-detail">
                        <i class="fas fa-calendar-alt"></i>
                        <span id="schoolYear">Año Escolar 2025</span>
                    </div>
                    <div class="teacher-detail">
                        <i class="fas fa-envelope"></i>
                        <span id="teacherEmail">Cargando...</span>
                    </div>
                </div>
            </div>
            <img id="teacherAvatar" src="https://ui-avatars.com/api/?name=Profesor&background=4CAF50&color=fff&size=80" alt="Avatar" class="teacher-avatar">
        </div>
        
        <!-- Alertas -->
        <div class="alert alert-success" id="successAlert"></div>
        <div class="alert alert-error" id="errorAlert"></div>
        
        <!-- Menú de opciones -->
        <div class="options-container">
            <div class="option-card" onclick="showSection('registro-notas')">
                <div class="option-icon">
                    <i class="fas fa-edit"></i>
                </div>
                <h3 class="option-title">Registro de Notas</h3>
                <p class="option-desc">Ingrese y actualice las calificaciones de sus estudiantes</p>
            </div>
            
            <div class="option-card" onclick="showSection('asistencia')">
                <div class="option-icon">
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <h3 class="option-title">Control de Asistencia</h3>
                <p class="option-desc">Registre y consulte la asistencia de sus estudiantes</p>
            </div>
            
            <div class="option-card" onclick="showSection('planificacion')">
                <div class="option-icon">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <h3 class="option-title">Planificación Académica</h3>
                <p class="option-desc">Organice sus planes de clase y actividades</p>
            </div>
            
            <div class="option-card" onclick="showSection('reportes')">
                <div class="option-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <h3 class="option-title">Reportes Académicos</h3>
                <p class="option-desc">Genere reportes de rendimiento por estudiante</p>
            </div>
            
            <div class="option-card" onclick="showSection('comunicados')">
                <div class="option-icon">
                    <i class="fas fa-comments"></i>
                </div>
                <h3 class="option-title">Comunicados</h3>
                <p class="option-desc">Envíe mensajes a estudiantes y padres</p>
            </div>
            
            <div class="option-card" onclick="showSection('configuracion')">
                <div class="option-icon">
                    <i class="fas fa-cog"></i>
                </div>
                <h3 class="option-title">Configuración</h3>
                <p class="option-desc">Ajuste sus preferencias personales</p>
            </div>
        </div>
        
        <!-- Sección: Registro de Notas -->
        <div id="registro-notas" class="section">
            <h2 class="section-title">
                <i class="fas fa-edit"></i> Registro de Calificaciones
            </h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="selectSeccion"><i class="fas fa-users"></i> Sección</label>
                    <select id="selectSeccion" class="form-control" onchange="cargarEstudiantes()">
                        <option value="">Seleccionar sección...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="selectMateria"><i class="fas fa-book"></i> Materia</label>
                    <select id="selectMateria" class="form-control" onchange="cargarEstudiantes()">
                        <option value="">Seleccionar materia...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="selectPeriodo"><i class="fas fa-calendar"></i> Período</label>
                    <select id="selectPeriodo" class="form-control" onchange="cargarEstudiantes()">
                        <option value="">Seleccionar período...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="selectTipoEvaluacion"><i class="fas fa-tasks"></i> Tipo de Evaluación</label>
                    <select id="selectTipoEvaluacion" class="form-control">
                        <option value="">Seleccionar tipo...</option>
                    </select>
                </div>
            </div>
            
            <div id="listaEstudiantes" class="table-container" style="display: none;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Estudiante</th>
                            <th>Código</th>
                            <th>Calificación</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaCalificaciones">
                        <!-- Los datos se cargarán dinámicamente -->
                    </tbody>
                </table>
                <div style="padding: 1rem; text-align: center;">
                    <button class="btn-primary" onclick="guardarCalificaciones()">
                        <i class="fas fa-save"></i> Guardar Todas las Calificaciones
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Sección: Control de Asistencia -->
        <div id="asistencia" class="section">
            <h2 class="section-title">
                <i class="fas fa-clipboard-check"></i> Control de Asistencia
            </h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="asistenciaSeccion"><i class="fas fa-users"></i> Sección</label>
                    <select id="asistenciaSeccion" class="form-control" onchange="cargarAsistencia()">
                        <option value="">Seleccionar sección...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="asistenciaFecha"><i class="fas fa-calendar-day"></i> Fecha</label>
                    <input type="date" id="asistenciaFecha" class="form-control" value="" onchange="cargarAsistencia()">
                </div>
            </div>
            
            <div id="listaAsistencia" class="table-container" style="display: none;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Estudiante</th>
                            <th>Código</th>
                            <th>Estado</th>
                            <th>Observaciones</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaAsistencia">
                        <!-- Los datos se cargarán dinámicamente -->
                    </tbody>
                </table>
                <div style="padding: 1rem; text-align: center;">
                    <button class="btn-primary" onclick="guardarAsistencia()">
                        <i class="fas fa-save"></i> Guardar Asistencia
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Sección: Planificación Académica -->
        <div id="planificacion" class="section">
            <h2 class="section-title">
                <i class="fas fa-calendar-alt"></i> Planificación Académica
            </h2>
            <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                <i class="fas fa-tools" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                <h3>En Desarrollo</h3>
                <p>Esta funcionalidad estará disponible en la próxima actualización</p>
            </div>
        </div>
        
        <!-- Sección: Reportes -->
        <div id="reportes" class="section">
            <h2 class="section-title">
                <i class="fas fa-chart-bar"></i> Reportes Académicos
            </h2>
            <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                <i class="fas fa-chart-line" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                <h3>En Desarrollo</h3>
                <p>Esta funcionalidad estará disponible en la próxima actualización</p>
            </div>
        </div>
        
        <!-- Sección: Comunicados -->
        <div id="comunicados" class="section">
            <h2 class="section-title">
                <i class="fas fa-comments"></i> Comunicados
            </h2>
            <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                <i class="fas fa-comment-dots" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                <h3>En Desarrollo</h3>
                <p>Esta funcionalidad estará disponible en la próxima actualización</p>
            </div>
        </div>
        
        <!-- Sección: Configuración -->
        <div id="configuracion" class="section">
            <h2 class="section-title">
                <i class="fas fa-cog"></i> Configuración
            </h2>
            <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                <i class="fas fa-user-cog" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                <h3>En Desarrollo</h3>
                <p>Esta funcionalidad estará disponible en la próxima actualización</p>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <p>© 2025 Institución Educativa John F. Kennedy - Todos los derechos reservados</p>
    </footer>

    <script>
        // Variables globales
        let currentUser = null;
        let estudiantes = [];
        let secciones = [];
        let materias = [];
        let periodos = [];
        let tiposEvaluacion = [];

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            // Establecer fecha actual por defecto
            document.getElementById('asistenciaFecha').value = new Date().toISOString().split('T')[0];
        });

        // Verificar autenticación
        async function checkAuth() {
            try {
                const response = await fetch('/api/user');
                if (!response.ok) {
                    window.location.href = '/';
                    return;
                }
                currentUser = await response.json();
                
                if (currentUser.tipo !== 'profesor') {
                    window.location.href = '/';
                    return;
                }
                
                // Actualizar información del profesor
                document.getElementById('teacherName').textContent = currentUser.nombres;
                document.getElementById('teacherFullName').textContent = `Prof. ${currentUser.nombres} ${currentUser.apellidos}`;
                document.getElementById('teacherCode').textContent = currentUser.codigo;
                document.getElementById('teacherEmail').textContent = currentUser.email;
                document.getElementById('teacherSpecialty').textContent = currentUser.especialidad || 'Especialidad no especificada';
                
                // Actualizar avatar
                if (currentUser.foto_url) {
                    document.getElementById('teacherAvatar').src = currentUser.foto_url;
                } else {
                    document.getElementById('teacherAvatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.nombres + ' ' + currentUser.apellidos)}&background=4CAF50&color=fff&size=80`;
                }
                
                // Cargar datos iniciales
                await cargarDatosIniciales();
                
            } catch (error) {
                console.error('Error verificando autenticación:', error);
                window.location.href = '/';
            }
        }

        // Cargar datos iniciales
        async function cargarDatosIniciales() {
            try {
                // Cargar secciones del profesor
                await cargarSecciones();
                // Cargar materias
                await cargarMaterias();
                // Cargar períodos
                await cargarPeriodos();
                // Cargar tipos de evaluación
                await cargarTiposEvaluacion();
                
            } catch (error) {
                console.error('Error cargando datos iniciales:', error);
                showError('Error al cargar los datos del sistema');
            }
        }

        // Cargar secciones
        async function cargarSecciones() {
            try {
                const response = await fetch('/api/secciones');
                if (!response.ok) throw new Error('Error al cargar secciones');
                
                secciones = await response.json();
                
                // Llenar select de secciones para notas
                const selectSeccion = document.getElementById('selectSeccion');
                selectSeccion.innerHTML = '<option value="">Seleccionar sección...</option>';
                
                // Llenar select de secciones para asistencia
                const selectAsistencia = document.getElementById('asistenciaSeccion');
                selectAsistencia.innerHTML = '<option value="">Seleccionar sección...</option>';
                
                secciones.forEach(seccion => {
                    const option1 = document.createElement('option');
                    option1.value = seccion.id;
                    option1.textContent = `${seccion.grado_nombre} - ${seccion.nombre}`;
                    selectSeccion.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = seccion.id;
                    option2.textContent = `${seccion.grado_nombre} - ${seccion.nombre}`;
                    selectAsistencia.appendChild(option2);
                });
                
            } catch (error) {
                console.error('Error cargando secciones:', error);
                throw error;
            }
        }

        // Cargar materias
        async function cargarMaterias() {
            try {
                // En un sistema real, esto vendría de una API
                // Por ahora usamos datos estáticos
                materias = [
                    { id: 1, nombre: 'Matemáticas', codigo: 'MAT-001' },
                    { id: 2, nombre: 'Lenguaje y Comunicación', codigo: 'LEN-001' },
                    { id: 3, nombre: 'Ciencias Naturales', codigo: 'CIE-001' },
                    { id: 4, nombre: 'Historia y Geografía', codigo: 'HIS-001' },
                    { id: 5, nombre: 'Inglés', codigo: 'ING-001' },
                    { id: 6, nombre: 'Educación Física', codigo: 'EFI-001' },
                    { id: 7, nombre: 'Arte y Cultura', codigo: 'ART-001' },
                    { id: 8, nombre: 'Tecnología e Informática', codigo: 'TEC-001' }
                ];
                
                const selectMateria = document.getElementById('selectMateria');
                selectMateria.innerHTML = '<option value="">Seleccionar materia...</option>';
                
                materias.forEach(materia => {
                    const option = document.createElement('option');
                    option.value = materia.id;
                    option.textContent = materia.nombre;
                    selectMateria.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error cargando materias:', error);
                throw error;
            }
        }

        // Cargar períodos
        async function cargarPeriodos() {
            try {
                // En un sistema real, esto vendría de una API
                periodos = [
                    { id: 1, nombre: 'Primer Período', orden: 1 },
                    { id: 2, nombre: 'Segundo Período', orden: 2 },
                    { id: 3, nombre: 'Tercer Período', orden: 3 },
                    { id: 4, nombre: 'Cuarto Período', orden: 4 }
                ];
                
                const selectPeriodo = document.getElementById('selectPeriodo');
                selectPeriodo.innerHTML = '<option value="">Seleccionar período...</option>';
                
                periodos.forEach(periodo => {
                    const option = document.createElement('option');
                    option.value = periodo.id;
                    option.textContent = periodo.nombre;
                    selectPeriodo.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error cargando períodos:', error);
                throw error;
            }
        }

        // Cargar tipos de evaluación
        async function cargarTiposEvaluacion() {
            try {
                // En un sistema real, esto vendría de una API
                tiposEvaluacion = [
                    { id: 1, nombre: 'Examen Parcial', peso: 30 },
                    { id: 2, nombre: 'Examen Final', peso: 40 },
                    { id: 3, nombre: 'Trabajos Prácticos', peso: 20 },
                    { id: 4, nombre: 'Participación', peso: 10 }
                ];
                
                const selectTipo = document.getElementById('selectTipoEvaluacion');
                selectTipo.innerHTML = '<option value="">Seleccionar tipo...</option>';
                
                tiposEvaluacion.forEach(tipo => {
                    const option = document.createElement('option');
                    option.value = tipo.id;
                    option.textContent = `${tipo.nombre} (${tipo.peso}%)`;
                    selectTipo.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error cargando tipos de evaluación:', error);
                throw error;
            }
        }

        // Cargar estudiantes para calificaciones
        async function cargarEstudiantes() {
            const seccionId = document.getElementById('selectSeccion').value;
            const materiaId = document.getElementById('selectMateria').value;
            const periodoId = document.getElementById('selectPeriodo').value;
            
            if (!seccionId || !materiaId || !periodoId) {
                document.getElementById('listaEstudiantes').style.display = 'none';
                return;
            }
            
            try {
                // Simular carga de estudiantes (en un sistema real sería una API)
                showLoading('tablaCalificaciones');
                document.getElementById('listaEstudiantes').style.display = 'block';
                
                // Datos de ejemplo
                setTimeout(() => {
                    estudiantes = [
                        { id: 1, codigo: 'EST-2025-001', nombres: 'Juan', apellidos: 'Pérez García', calificacion: '' },
                        { id: 2, codigo: 'EST-2025-002', nombres: 'María', apellidos: 'López Hernández', calificacion: '' },
                        { id: 3, codigo: 'EST-2025-003', nombres: 'Carlos', apellidos: 'Gómez Martínez', calificacion: '' },
                        { id: 4, codigo: 'EST-2025-004', nombres: 'Ana', apellidos: 'Rodríguez Silva', calificacion: '' }
                    ];
                    
                    actualizarTablaCalificaciones();
                }, 1000);
                
            } catch (error) {
                console.error('Error cargando estudiantes:', error);
                showError('Error al cargar los estudiantes');
            }
        }

        // Cargar asistencia
        async function cargarAsistencia() {
            const seccionId = document.getElementById('asistenciaSeccion').value;
            const fecha = document.getElementById('asistenciaFecha').value;
            
            if (!seccionId || !fecha) {
                document.getElementById('listaAsistencia').style.display = 'none';
                return;
            }
            
            try {
                showLoading('tablaAsistencia');
                document.getElementById('listaAsistencia').style.display = 'block';
                
                // Simular carga de datos
                setTimeout(() => {
                    estudiantes = [
                        { id: 1, codigo: 'EST-2025-001', nombres: 'Juan', apellidos: 'Pérez García', asistencia: 'presente', observaciones: '' },
                        { id: 2, codigo: 'EST-2025-002', nombres: 'María', apellidos: 'López Hernández', asistencia: 'ausente', observaciones: 'Enfermo' },
                        { id: 3, codigo: 'EST-2025-003', nombres: 'Carlos', apellidos: 'Gómez Martínez', asistencia: 'presente', observaciones: '' },
                        { id: 4, codigo: 'EST-2025-004', nombres: 'Ana', apellidos: 'Rodríguez Silva', asistencia: 'tardanza', observaciones: 'Llegó 15 minutos tarde' }
                    ];
                    
                    actualizarTablaAsistencia();
                }, 1000);
                
            } catch (error) {
                console.error('Error cargando asistencia:', error);
                showError('Error al cargar la asistencia');
            }
        }

        // Actualizar tabla de calificaciones
        function actualizarTablaCalificaciones() {
            const tbody = document.getElementById('tablaCalificaciones');
            tbody.innerHTML = '';
            
            estudiantes.forEach(estudiante => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <strong>${estudiante.nombres} ${estudiante.apellidos}</strong>
                    </td>
                    <td>${estudiante.codigo}</td>
                    <td>
                        <input type="number" 
                               step="0.1" 
                               min="0" 
                               max="20" 
                               value="${estudiante.calificacion || ''}" 
                               onchange="actualizarCalificacion(${estudiante.id}, this.value)"
                               style="width: 80px; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px;">
                    </td>
                    <td>
                        <button class="btn-primary" onclick="guardarCalificacionIndividual(${estudiante.id})" style="padding: 0.4rem 0.8rem;">
                            <i class="fas fa-save"></i> Guardar
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Actualizar tabla de asistencia
        function actualizarTablaAsistencia() {
            const tbody = document.getElementById('tablaAsistencia');
            tbody.innerHTML = '';
            
            estudiantes.forEach(estudiante => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <strong>${estudiante.nombres} ${estudiante.apellidos}</strong>
                    </td>
                    <td>${estudiante.codigo}</td>
                    <td>
                        <select onchange="actualizarAsistencia(${estudiante.id}, 'estado', this.value)" 
                                style="padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px;">
                            <option value="presente" ${estudiante.asistencia === 'presente' ? 'selected' : ''}>Presente</option>
                            <option value="ausente" ${estudiante.asistencia === 'ausente' ? 'selected' : ''}>Ausente</option>
                            <option value="justificado" ${estudiante.asistencia === 'justificado' ? 'selected' : ''}>Justificado</option>
                            <option value="tardanza" ${estudiante.asistencia === 'tardanza' ? 'selected' : ''}>Tardanza</option>
                        </select>
                    </td>
                    <td>
                        <input type="text" 
                               value="${estudiante.observaciones || ''}" 
                               placeholder="Observaciones..."
                               onchange="actualizarAsistencia(${estudiante.id}, 'observaciones', this.value)"
                               style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 4px;">
                    </td>
                    <td>
                        <button class="btn-primary" onclick="guardarAsistenciaIndividual(${estudiante.id})" style="padding: 0.4rem 0.8rem;">
                            <i class="fas fa-save"></i> Guardar
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Mostrar sección específica
        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Mostrar la sección seleccionada
            document.getElementById(sectionId).classList.add('active');
            
            // Animación de clic en la tarjeta
            const card = event.currentTarget;
            card.style.transform = 'scale(0.95)';
            setTimeout(() => {
                card.style.transform = '';
            }, 200);
        }

        // Funciones para calificaciones
        function actualizarCalificacion(estudianteId, calificacion) {
            const estudiante = estudiantes.find(e => e.id === estudianteId);
            if (estudiante) {
                estudiante.calificacion = calificacion;
            }
        }

        function guardarCalificacionIndividual(estudianteId) {
            const estudiante = estudiantes.find(e => e.id === estudianteId);
            if (estudiante && estudiante.calificacion) {
                showSuccess(`Calificación de ${estudiante.nombres} guardada: ${estudiante.calificacion}`);
            } else {
                showError('Ingrese una calificación válida');
            }
        }

        async function guardarCalificaciones() {
            const calificacionesValidas = estudiantes.filter(e => e.calificacion && e.calificacion >= 0 && e.calificacion <= 20);
            
            if (calificacionesValidas.length === 0) {
                showError('No hay calificaciones válidas para guardar');
                return;
            }
            
            try {
                // Simular guardado en base de datos
                showSuccess(`Se guardaron ${calificacionesValidas.length} calificaciones correctamente`);
                
            } catch (error) {
                console.error('Error guardando calificaciones:', error);
                showError('Error al guardar las calificaciones');
            }
        }

        // Funciones para asistencia
        function actualizarAsistencia(estudianteId, campo, valor) {
            const estudiante = estudiantes.find(e => e.id === estudianteId);
            if (estudiante) {
                estudiante[campo] = valor;
            }
        }

        function guardarAsistenciaIndividual(estudianteId) {
            const estudiante = estudiantes.find(e => e.id === estudianteId);
            if (estudiante) {
                showSuccess(`Asistencia de ${estudiante.nombres} guardada: ${estudiante.asistencia}`);
            }
        }

        async function guardarAsistencia() {
            try {
                // Simular guardado en base de datos
                showSuccess('Asistencia guardada correctamente para todos los estudiantes');
                
            } catch (error) {
                console.error('Error guardando asistencia:', error);
                showError('Error al guardar la asistencia');
            }
        }

        // Utilidades
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <tr>
                    <td colspan="4" style="text-align: center; padding: 2rem;">
                        <div class="loading">
                            <i class="fas fa-spinner fa-spin"></i> Cargando...
                        </div>
                    </td>
                </tr>
            `;
        }

        function showSuccess(message) {
            const alert = document.getElementById('successAlert');
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        function showError(message) {
            const alert = document.getElementById('errorAlert');
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // Cerrar sesión
        async function logout() {
            if (confirm("¿Estás seguro que deseas cerrar sesión?")) {
                try {
                    await fetch('/api/logout', { method: 'POST' });
                    window.location.href = '/';
                } catch (error) {
                    console.error('Error al cerrar sesión:', error);
                }
            }
        }

        // Efecto de carga inicial para las tarjetas
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const cards = document.querySelectorAll('.option-card');
                cards.forEach((card, index) => {
                    setTimeout(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, index * 100);
                });
            }, 500);
        });
    </script>
</body>
</html>
